<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API Reference" href="api/modules.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2023.09.10 -->
        <title>LHD-FICXS-py 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="#"><div class="brand">LHD-FICXS-py 0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="#">
  
  
  <span class="sidebar-brand-text">LHD-FICXS-py 0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/modules.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="api/lhd_fidasim.html">lhd_fidasim</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of lhd_fidasim</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="api/lhd_fidasim.Goldston.html">lhd_fidasim: Goldston</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/lhd_fidasim.distribution.html">lhd_fidasim: distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/lhd_fidasim.equilibrium.html">lhd_fidasim: equilibrium</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/lhd_fidasim.geometry.html">lhd_fidasim: geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/lhd_fidasim.inputs.html">lhd_fidasim: inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/lhd_fidasim.plot_nbi_geo.html">lhd_fidasim: plot_nbi_geo</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="lhd-ficxs-py-documentation">
<h1>LHD-FICXS-py documentation<a class="headerlink" href="#lhd-ficxs-py-documentation" title="Permalink to this heading">#</a></h1>
<section id="python-tools-to-analyze-fast-ion-data-from-the-large-helical-device">
<h2>Python tools to analyze fast ion data from the Large Helical Device.<a class="headerlink" href="#python-tools-to-analyze-fast-ion-data-from-the-large-helical-device" title="Permalink to this heading">#</a></h2>
<p>This repository is primarily concerned with analysis of data from the fast-ion charge-exchange spectroscopy (FICXS) system on the Large Helical Device (LHD).</p>
<section id="installation-linux">
<h3>Installation (Linux)<a class="headerlink" href="#installation-linux" title="Permalink to this heading">#</a></h3>
<p>To use the package, simply clone the repository from github and append the directory path to the pythonpath.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">hayashiw</span><span class="o">/</span><span class="n">lhd_ficxs_py</span><span class="o">.</span><span class="n">git</span>
<span class="n">export</span> <span class="n">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{PYTHONPATH}</span><span class="s2">:$(pwd)/lhd_ficxs_py&quot;</span>
</pre></div>
</div>
</section>
<section id="configuring-directory-paths">
<h3>Configuring directory paths<a class="headerlink" href="#configuring-directory-paths" title="Permalink to this heading">#</a></h3>
<p>Included in the package is the <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file.
This files contains the relevant directory paths for your LHD data.
Make sure the <code class="docutils literal notranslate"><span class="pre">data_dir</span></code> and <code class="docutils literal notranslate"><span class="pre">pqt_dir</span></code> are correctly set to the directories that you will be using.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">data_directories</span><span class="p">]</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">LHD</span><span class="o">/</span><span class="n">data</span>
<span class="n">pqt_dir</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">parquet</span><span class="o">/</span><span class="n">data</span>
</pre></div>
</div>
<p>For information on the use of parquet files see <span class="xref std std-ref">Handling FICXS data files</span>.</p>
</section>
<section id="reading-in-data">
<h3>Reading in data<a class="headerlink" href="#reading-in-data" title="Permalink to this heading">#</a></h3>
<p>LHD data is typically stored in comma-separated ASCII files with the .dat extension.
Most .dat files can be read in using the <code class="docutils literal notranslate"><span class="pre">read_data</span></code> subroutine.
This will return the data as a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">lhd_ficxs_py</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_data</span>

<span class="n">dat_file</span> <span class="o">=</span> <span class="s1">&#39;./nb1pwr_temporal.dat&#39;</span>
<span class="n">nb1_df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="n">dat_file</span><span class="p">,</span> <span class="n">use_postgres_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert_to_ms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># use_postgres_names converts column names to lower-snake-case format</span>
<span class="c1"># convert_to_ms converts the time column to milliseconds</span>
<span class="n">pinj</span> <span class="o">=</span> <span class="n">nb1_df</span><span class="p">[</span><span class="s1">&#39;pport_through_nb1&#39;</span><span class="p">]</span>
<span class="n">pinj_units</span> <span class="o">=</span> <span class="n">nb1_df</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="c1"># MW</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">_handling</span><span class="o">-</span><span class="n">ficxs</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">files</span><span class="p">:</span>
</pre></div>
</div>
</section>
<section id="handling-ficxs-data-files">
<h3>Handling FICXS data files<a class="headerlink" href="#handling-ficxs-data-files" title="Permalink to this heading">#</a></h3>
<p>Calibrated FICXS data is written to .dat files, the standard file type for LHD data.
Due to the size of these files, file IO becomes a bottleneck when analyzing multiple cases.
It is helpful to compress FICXS .dat files into parquet files.
This can be easily done using the <code class="docutils literal notranslate"><span class="pre">lhd_ficxs_py.io.convert_dat_to_pqt</span></code> subroutine.
They can then be quickly read in using <code class="docutils literal notranslate"><span class="pre">pandas.read_parquet</span></code>.
An additional subroutine <code class="docutils literal notranslate"><span class="pre">lhd_ficxs_py.io.read_ficxs_from_pqt</span></code> is available to format FICXS dataframes into the expected format for <code class="docutils literal notranslate"><span class="pre">lhd_ficxs_py</span></code>.</p>
</section>
<section id="calculating-timing-for-active-ficxs-signal">
<h3>Calculating timing for active FICXS signal<a class="headerlink" href="#calculating-timing-for-active-ficxs-signal" title="Permalink to this heading">#</a></h3>
<p>The main purpose of this package is to generate the diagnostic-beam-on and -off time stamps for the FICXS system.
This can be done using <code class="docutils literal notranslate"><span class="pre">lhd_ficxs_py.run</span></code> from the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">lhd_ficxs_py_env</span><span class="p">):</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">lhd_ficxs_py</span><span class="o">.</span><span class="n">run</span> <span class="p">{</span><span class="n">shot_num</span><span class="p">}</span> <span class="p">{</span><span class="n">los</span><span class="p">}</span>
</pre></div>
</div>
<p>The first argument <code class="docutils literal notranslate"><span class="pre">{shot_num}</span></code> should be replaced with the LHD discharge number.
This is used to set the paths for the input data files, namely the NBI .dat files, ECH .dat file, and FICXS parquet file.
These files have to be retrieved by the user before lhd_ficxs_py can be used.
The second argument <code class="docutils literal notranslate"><span class="pre">{los}</span></code> is an integer (6 or 7) that refers to the FICXS sightline (line-of-sight or LOS).
There are two LOS for the LHD FICXS system: 6-O and 7-O.
Details about the two sightlines can be found in <a class="footnote-reference brackets" href="#id3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#id4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
</section>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h2>
<p>This package was written using the following:
- python 3.13.5</p>
<blockquote>
<div><ul class="simple">
<li><p>h5py 3.14.0</p></li>
<li><p>matplotlib 3.10.6</p></li>
<li><p>netCDF4 1.7.2</p></li>
<li><p>numpy 2.3.3</p></li>
<li><p>pandas 2.3.3</p></li>
<li><p>pyarrow 21.0.0</p></li>
<li><p>scipy 1.16.2</p></li>
</ul>
</div></blockquote>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Fujiwara, Y., Kamio, S., Yamaguchi, H., Garcia, A.V., Stagner, L., Nuga, H., Seki, R., Ogawa, K., Isobe, M., Yokoyama, M., Fast-ion D alpha diagnostic with 3D-supporting FIDASIM in the Large Helical Device <em>Nuclear Fusion</em> <strong>60</strong> (2020) 112014 doi:<a class="reference external" href="https://doi.org/10.1088/1741-4326/abae84">10.1088/1741-4326/abae84</a>.</p>
</aside>
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Hayashi, W.H.J., Heidbrink, W.W., Muscatello, C.M., Lin, D.J., Osakabe, M., Ogawa, K., Kawamoto, Y., Yamaguchi, H., Seki, R., Nuga, H., Charge-exchange measurements of high-energy fast ions in LHD using negative-ion neutral beam injection <em>Journal of Instrumentation</em> <strong>19</strong> (2024) P12006 doi:<a class="reference external" href="https://doi.org/10.1088/1748-0221/19/12/P12006">10.1088/1748-0221/19/12/P12006</a>.</p>
</aside>
</aside>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/lhd_fidasim.html">lhd_fidasim</a></li>
</ul>
</li>
</ul>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api/modules.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, W.H.J. Hayashi
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">LHD-FICXS-py documentation</a><ul>
<li><a class="reference internal" href="#python-tools-to-analyze-fast-ion-data-from-the-large-helical-device">Python tools to analyze fast ion data from the Large Helical Device.</a><ul>
<li><a class="reference internal" href="#installation-linux">Installation (Linux)</a></li>
<li><a class="reference internal" href="#configuring-directory-paths">Configuring directory paths</a></li>
<li><a class="reference internal" href="#reading-in-data">Reading in data</a></li>
<li><a class="reference internal" href="#handling-ficxs-data-files">Handling FICXS data files</a></li>
<li><a class="reference internal" href="#calculating-timing-for-active-ficxs-signal">Calculating timing for active FICXS signal</a></li>
</ul>
</li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=e031e9a9"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>